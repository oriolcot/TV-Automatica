name: Actualitzar Futbol

on:
  schedule:
    - cron: '0 */4 * * *' # Cada 4 hores
  workflow_dispatch: # BotÃ³ manual

permissions:
  contents: write # âš ï¸ IMPRESCINDIBLE per guardar fitxers

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Baixar el codi
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Baixa tot l'historial per evitar errors de git

      - name: ğŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: ğŸ“¦ InstalÂ·lar llibreries
        run: pip install requests

      - name: ğŸš€ Executar Generador
        env:
          API_URL: ${{ secrets.API_URL }}
          API_URL_PPV: ${{ secrets.API_URL_PPV }}
        run: python generator.py

      - name: ğŸ” DIAGNÃ’STIC - Comprovar si existeix index.html
        run: |
          ls -la
          if [ -f index.html ]; then
            echo "âœ… ÃˆXIT: El fitxer index.html s'ha generat correctament!"
          else
            echo "âŒ ERROR FATAL: El fitxer index.html NO existeix. El script de Python ha fallat silenciosament."
            exit 1
          fi

      - name: ğŸ’¾ Guardar i Pujar (Push automÃ tic a la branca actual)
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "action@github.com"
          
          # Forcem l'afegit del fitxer per si de cas
          git add -f index.html memoria_partits.json memoria_backup.json
          
          # Mirem l'estat abans de fer commit
          git status
          
          # Fem commit i push a la branca que toqui (main o master)
          git commit -m "Auto-update: Web actualitzada âš½" || echo "âš ï¸ No hi ha canvis nous, tot estÃ  al dia."
          git push origin HEAD:${{ github.ref_name }}